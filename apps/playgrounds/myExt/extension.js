(()=>{"use strict";var e={398:e=>{e.exports=require("vscode")},690:function(e,t,r){var o=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,i)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&o(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.activate=async function(e){console.log("ðŸš€ Tutly File System extension starting...");const t=new a,r=s.workspace.registerFileSystemProvider("tutly",t,{isCaseSensitive:!0,isReadonly:!1});e.subscriptions.push(r);const o=new c(t),i=s.window.createTreeView("tutlyExplorer",{treeDataProvider:o,showCollapseAll:!0});e.subscriptions.push(i);const n=s.commands.registerCommand("tutly.refresh",async()=>{console.log("ðŸ”„ Refresh command triggered"),o.refresh(),t._emitter.fire([]);const e=s.workspace.workspaceFolders?.find(e=>"tutly"===e.uri.scheme);e&&setTimeout(()=>{s.workspace.updateWorkspaceFolders(e.index,1,{uri:e.uri,name:e.name})&&console.log("âœ… Workspace refreshed")},100)});e.subscriptions.push(n);const l=s.commands.registerCommand("tutly.connectToServer",async()=>{try{await t.ensureConnected(),s.window.showInformationMessage("âœ… Connected to Tutly file server"),o.refresh()}catch(e){s.window.showErrorMessage(`âŒ Connection failed: ${e}`)}});e.subscriptions.push(l);const h=s.commands.registerCommand("tutly.openWorkspace",()=>{s.workspace.updateWorkspaceFolders(0,0,{uri:s.Uri.parse("tutly:/"),name:"ðŸ“ Tutly Files"})?s.window.showInformationMessage("âœ… Tutly workspace added"):s.window.showErrorMessage("âŒ Failed to add workspace")});e.subscriptions.push(h);try{if(console.log("ðŸ”Œ Connecting to Tutly file server..."),!s.workspace.updateWorkspaceFolders(0,null,{uri:s.Uri.parse("tutly:/"),name:"ðŸ“ Tutly Files"}))throw new Error("Failed to add workspace folder");console.log("âœ… Workspace folder added successfully!"),t.ensureConnected().then(()=>{console.log("âœ… Connected to file server"),s.window.setStatusBarMessage("$(check) Tutly Files connected!",3e3),o.refresh()}).catch(e=>{console.error("âŒ Connection failed:",e),s.window.setStatusBarMessage("$(error) Tutly server not available",5e3),o.refresh()})}catch(e){console.error("âŒ Activation failed:",e),s.window.showErrorMessage(`Tutly Files: ${e}`)}console.log("âœ… Extension activated successfully")},t.deactivate=function(){console.log("ðŸ‘‹ Tutly File System extension deactivated")};const s=n(r(398));class a{constructor(){this._emitter=new s.EventEmitter,this.onDidChangeFile=this._emitter.event,this._connected=!1,this._connecting=!1}async ensureConnected(){if(!this._connected)if(this._connecting)for(;this._connecting;)await new Promise(e=>setTimeout(e,100));else{this._connecting=!0;try{console.log("ðŸ”Œ Testing connection to file server...");const e=await fetch("http://localhost:3001/api/health",{headers:{"x-api-key":"tutly-dev-key"}});if(!e.ok)throw new Error(`Server responded with ${e.status}`);this._connected=!0,console.log("âœ… Connected to file server")}catch(e){throw console.error("âŒ Failed to connect to file server:",e),new Error("Unable to connect to Tutly file server. Make sure it's running on localhost:3001")}finally{this._connecting=!1}}}async apiRequest(e=""){await this.ensureConnected();const t="http://localhost:3001/api/files"+(e?`/${e}`:"");console.log(`ðŸ“¡ API Request: ${t}`);const r=await fetch(t,{headers:{"x-api-key":"tutly-dev-key"}});if(!r.ok)throw new Error(`API Error: ${r.status}`);return await r.json()}async stat(e){console.log(`ðŸ“Š stat called for: ${e.path}`);const t=e.path.substring(1);try{const e=await this.apiRequest(t);return e.entries?{type:s.FileType.Directory,ctime:Date.now(),mtime:Date.now(),size:0}:{type:s.FileType.File,ctime:Date.now(),mtime:Date.now(),size:e.size||0}}catch(t){throw console.error("stat error:",t),s.FileSystemError.FileNotFound(e)}}async readDirectory(e){console.log(`ðŸ“ readDirectory called for: ${e.path}`);const t=e.path.substring(1);try{const e=await this.apiRequest(t);if(!e.entries)throw new Error("Not a directory");return e.entries.map(e=>[e.name,"directory"===e.type?s.FileType.Directory:s.FileType.File])}catch(t){throw console.error("readDirectory error:",t),s.FileSystemError.FileNotFound(e)}}async readFile(e){console.log(`ðŸ“„ readFile called for: ${e.path}`);const t=e.path.substring(1);try{const e=await this.apiRequest(t);if(void 0===e.content)throw new Error("No file content");return(new TextEncoder).encode(e.content)}catch(t){throw console.error("readFile error:",t),s.FileSystemError.FileNotFound(e)}}async writeFile(e,t,r){const o=e.path.substring(1);try{const i=await this.fileExists(e);if(i&&!r.overwrite)throw s.FileSystemError.FileExists(e);if(!i&&!r.create)throw s.FileSystemError.FileNotFound(e);const n=(new TextDecoder).decode(t),a=`http://localhost:3001/api/files/${o}`,c=await fetch(a,{method:i?"PUT":"POST",headers:{"x-api-key":"tutly-dev-key","Content-Type":"application/json"},body:JSON.stringify({type:"file",content:n,binary:!1})});if(!c.ok)throw new Error(`API Error: ${c.status}`);this._emitter.fire([{type:s.FileChangeType.Changed,uri:e}])}catch(t){throw console.error("writeFile error:",t),s.FileSystemError.Unavailable(e)}}async rename(e,t,r){try{const o=await this.readFile(e);await this.writeFile(t,o,{create:!0,overwrite:r.overwrite}),await this.delete(e,{recursive:!1}),this._emitter.fire([{type:s.FileChangeType.Deleted,uri:e},{type:s.FileChangeType.Created,uri:t}])}catch(t){throw console.error("rename error:",t),s.FileSystemError.Unavailable(e)}}async delete(e,t){const r=e.path.substring(1);try{const t=`http://localhost:3001/api/files/${r}`,o=await fetch(t,{method:"DELETE",headers:{"x-api-key":"tutly-dev-key"}});if(!o.ok)throw new Error(`API Error: ${o.status}`);this._emitter.fire([{type:s.FileChangeType.Deleted,uri:e}])}catch(t){throw console.error("delete error:",t),s.FileSystemError.FileNotFound(e)}}async createDirectory(e){const t=e.path.substring(1);try{const r=`http://localhost:3001/api/files/${t}`,o=await fetch(r,{method:"POST",headers:{"x-api-key":"tutly-dev-key","Content-Type":"application/json"},body:JSON.stringify({type:"directory"})});if(!o.ok)throw new Error(`API Error: ${o.status}`);this._emitter.fire([{type:s.FileChangeType.Created,uri:e}])}catch(t){throw console.error("createDirectory error:",t),s.FileSystemError.Unavailable(e)}}async fileExists(e){try{return await this.stat(e),!0}catch{return!1}}watch(){return new s.Disposable(()=>{})}}class c{constructor(e){this.provider=e,this._onDidChangeTreeData=new s.EventEmitter,this.onDidChangeTreeData=this._onDidChangeTreeData.event,this._isLoading=!1}refresh(){this._isLoading=!0,this._onDidChangeTreeData.fire()}getTreeItem(e){if("string"==typeof e){if("loading"===e){const e=new s.TreeItem("ðŸ”„ Connecting to Tutly server...",s.TreeItemCollapsibleState.None);return e.description="Please wait",e.iconPath=new s.ThemeIcon("loading~spin"),e}if("error"===e){const e=new s.TreeItem("âŒ Connection failed",s.TreeItemCollapsibleState.None);return e.description="Server not available",e.iconPath=new s.ThemeIcon("error"),e}if("refreshing"===e){const e=new s.TreeItem("ðŸ”„ Refreshing files...",s.TreeItemCollapsibleState.None);return e.description="Loading",e.iconPath=new s.ThemeIcon("loading~spin"),e}}const t=e,r=new s.TreeItem(t);return r.resourceUri=t,r}async getChildren(e){if(!e){if(this._isLoading)return["refreshing"];try{return await this.provider.ensureConnected(),this._isLoading=!1,[s.Uri.parse("tutly:/")]}catch(e){return this._isLoading=!1,["error"]}}if("string"==typeof e)return[];try{const t=await this.provider.readDirectory(e);return this._isLoading=!1,t.map(([t,r])=>s.Uri.joinPath(e,t))}catch(e){return console.error("Failed to read directory:",e),this._isLoading=!1,[]}}}}},t={},r=function r(o){var i=t[o];if(void 0!==i)return i.exports;var n=t[o]={exports:{}};return e[o].call(n.exports,n,n.exports,r),n.exports}(690);module.exports=r})();
//# sourceMappingURL=extension.js.map